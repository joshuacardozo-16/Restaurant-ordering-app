{% extends "base.html" %}
{% block title %}Checkout{% endblock %}

{% block content %}
<div class="row g-4">
  <div class="col-lg-7">
    <div class="card shadow-sm border-0">
      <div class="card-body p-4 p-md-5">
        <h1 class="h4 mb-3">Checkout</h1>

        <form method="post">
          {{ form.hidden_tag() }}

          <div class="mb-3">
            <label class="form-label d-block">Order type</label>
            <div class="d-flex gap-3">
              {% for subfield in form.order_type %}
                <div class="form-check">
                  {{ subfield(class_="form-check-input") }}
                  {{ subfield.label(class_="form-check-label") }}
                </div>
              {% endfor %}
            </div>
          </div>

          <div id="delivery_fields">
            <h2 class="h6 mt-3">Delivery address</h2>
            <div class="mb-3">
              {{ form.delivery_address_line1.label(class_="form-label") }}
              {{ form.delivery_address_line1(class_="form-control") }}
            </div>
            <div class="mb-3">
              {{ form.delivery_address_line2.label(class_="form-label") }}
              {{ form.delivery_address_line2(class_="form-control") }}
            </div>
            <div class="row g-3">
              <div class="col-md-6">
                {{ form.city.label(class_="form-label") }}
                {{ form.city(class_="form-control") }}
              </div>
              <div class="col-md-6">
                {{ form.postcode.label(class_="form-label") }}
                {{ form.postcode(class_="form-control") }}
              </div>
            </div>
            <div class="mt-3">
              {{ form.delivery_instructions.label(class_="form-label") }}
              {{ form.delivery_instructions(class_="form-control", rows="3") }}
            </div>
          </div>

          <div id="pickup_fields" class="mt-3">
            <h2 class="h6">Pickup</h2>
            <div class="mb-3">
              {{ form.pickup_time_requested.label(class_="form-label") }}
              {{ form.pickup_time_requested(class_="form-control", placeholder="e.g. 18:30") }}
            </div>
          </div>

          <div class="d-grid mt-4">
            {{ form.submit(class_="btn btn-dark btn-lg") }}
          </div>
        </form>

      </div>
    </div>
  </div>

  <div class="col-lg-5">
    <div class="card shadow-sm border-0">
      <div class="card-body p-4">
        <h2 class="h6 mb-3">Order summary</h2>

        <div class="list-group list-group-flush">
          {% for row in cart_rows %}
            <div class="list-group-item d-flex justify-content-between">
              <div>
                <div class="fw-semibold">{{ row.item.name }}</div>
                <div class="text-muted small">Qty: {{ row.qty }}</div>
              </div>
              <div class="fw-semibold">£{{ "%.2f"|format(row.line_total) }}</div>
            </div>
          {% endfor %}
        </div>

        <div class="d-flex justify-content-between mt-3">
          <div class="fw-semibold">Total</div>
          <div class="fw-semibold">£{{ "%.2f"|format(total) }}</div>
        </div>

        <div class="text-muted small mt-2">
          Tip: Delivery needs Address line 1, City and Postcode. Pickup needs a pickup time.
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  function toggleFields() {
    const selected = document.querySelector('input[name="order_type"]:checked')?.value;
    const deliveryFields = document.getElementById("delivery_fields");
    const pickupFields = document.getElementById("pickup_fields");

    if (selected === "delivery") {
      deliveryFields.style.display = "block";
      pickupFields.style.display = "none";
    } else {
      deliveryFields.style.display = "none";
      pickupFields.style.display = "block";
    }
  }

  document.addEventListener("DOMContentLoaded", () => {
    toggleFields();
    document.querySelectorAll('input[name="order_type"]').forEach((el) => {
      el.addEventListener("change", toggleFields);
    });
  });
</script>
{% endblock %}
