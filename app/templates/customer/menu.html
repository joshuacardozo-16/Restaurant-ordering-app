{% extends "base.html" %}
{% block title %}Menu{% endblock %}

{% block content %}
<div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-3 mb-3">
  <div>
    <h1 class="h4 mb-0">Menu</h1>
    <div class="text-muted small">Choose your favourites — delivery or pickup.</div>
  </div>

  <form class="d-flex gap-2" method="get" action="{{ url_for('customer.menu') }}">
    <select class="form-select" name="category">
      <option value="">All categories</option>
      {% for c in categories %}
        <option value="{{ c }}" {% if c == category %}selected{% endif %}>{{ c }}</option>
      {% endfor %}
    </select>
    <input class="form-control" name="q" value="{{ q }}" placeholder="Search..." />
    <button class="btn btn-dark" type="submit">Search</button>
  </form>
</div>

<div class="row g-3">
  {% for i in items %}
  <div class="col-12 col-md-6 col-lg-4">
    <div class="card shadow-sm border-0 h-100">
      {% if i.image_url %}
        <img src="{{ i.image_url }}" class="card-img-top" style="object-fit:cover; height:180px;" alt="{{ i.name }}">
      {% endif %}
      <div class="card-body d-flex flex-column">
        <div class="d-flex justify-content-between align-items-start">
          <h2 class="h6 mb-1">{{ i.name }}</h2>
          <span class="badge text-bg-dark">£{{ "%.2f"|format(i.price) }}</span>
        </div>
        <div class="text-muted small mb-3">{{ i.category }}</div>
        {% if i.description %}
          <p class="text-muted small flex-grow-1">{{ i.description }}</p>
        {% else %}
          <div class="flex-grow-1"></div>
        {% endif %}

        {% if current_user.is_authenticated %}
          <form method="post" action="{{ url_for('customer.cart_add', item_id=i.id) }}">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button class="btn btn-warning w-100" type="submit">Add to cart</button>
          </form>
        {% else %}
          <a class="btn btn-outline-dark w-100" href="{{ url_for('auth.login') }}">Login to order</a>
        {% endif %}
      </div>
    </div>
  </div>
  {% endfor %}

  {% if not items %}
    <div class="col-12">
      <div class="p-4 bg-white rounded-4 border shadow-sm text-center text-muted">
        No items found.
      </div>
    </div>
  {% endif %}
</div>
{% endblock %}
